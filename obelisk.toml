## Supported path prefixes:
## | Prefix       | Default path            | Details
## | ${DATA_DIR}  |  ~/.local/share/obelisk | https://docs.rs/directories/5.0.1/directories/struct.ProjectDirs.html#method.data_dir
## | ${CACHE_DIR} |  ~/.cache/obelisk       | https://docs.rs/directories/5.0.1/directories/struct.ProjectDirs.html#method.cache_dir
## | ${CONFIG_DIR}|  ~/.config/obelisk      | https://docs.rs/directories/5.0.1/directories/struct.ProjectDirs.html#method.config_dir

## Server configuration
api_listening_addr = "127.0.0.1:5005" # Address and port on which the API server will listen.

# sqlite_file = "${DATA_DIR}/obelisk.sqlite" # Path to sqlite database. Supports path prefixes.

# oci.wasm_directory = "${CACHE_DIR}/wasm" # Path to directory where wasm files downloaded from an OCI registry are stored. Supports path prefixes.

## Comment out the `codegen_cache` table to disable the codegen cache.
[codegen_cache]
# directory = "${CACHE_DIR}/codegen" # Path to directory where generated code is cached. Supports path prefixes.

## WASM Component configuration
## Common settings for all components
# name = "name" # Each component must be named.
## Location can be a file path or an OCI registry reference.
# location.path = "path/to/wasm"
# location.oci = "docker.io/repo/image:tag"
# content_digest = "sha256:AA.." # Optional. If specified, the WASM file must have a matching hash.
# exec_config.batch_size = 5 # Number of executions to lock for every event loop tick.
# exec_config.lock_expiry.secs = 1 # Each execution is locked for 1s by default.
# exec_config.tick_sleep.millis = 200 # Sleep between event loop ticks.

## WASM Activity components configuration
# [[wasm_activity]]
## Common settings for all components - see above
## Specific settings for wasm_activity:
# recycle_instances = true # If true, the same WASM instance will be used again instead of creating new instance for performance reasons.
# default_max_retries = 5 # When calling the activity directly, `default_max_retries` is applied.
# default_retry_exp_backoff.millis = 100 # Exponential backoff setting.

## WASM Workflow components configuration
## Common settings for all components - see above
## Joining strategy: When workflow requests a child execution result, it can either be interrupted, or kept in the memory.
## When "interrupt" is selected, after every child execution result the whole event history must be replayed.
# join_next_blocking_strategy = "await" # Default strategy is "await"/
# child_max_retries = 100 # When calling an activity, overrides its default `default_max_retries`
# child_retry_exp_backoff.millis = 100 # When calling an activity, overrides its default `default_retry_exp_backoff`
# non_blocking_event_batching = 100 # Number of non-blocking events that can be cached and written in a batch.

[[wasm_activity]]
name = "fibo_activity"
location.oci = "docker.io/getobelisk/example_activity_fibo:2024-08-12-1@sha256:d33ea7dde23bb8204e8916a4ca868195c1d66b0459bf0e3bc874cb27e25abf3e"

# TODO: FS allowance

[[workflow]]
name = "fibo_workflow"
location.oci = "docker.io/getobelisk/example_workflow_fibo:2024-08-12-1@sha256:3da8be596e87693335423e52482cc2edc7424b40fa7ebcdd82d104eb94c2c418"
exec.lock_expiry.secs = 10

[[wasm_activity]]
name = "http_get_activity"
location.oci = "docker.io/getobelisk/example_activity_http_get:2024-08-12-1@sha256:deb576c153e375f7c1f016d82860fa6e1cf50264944b078858f577d54d2a9863"
exec.lock_expiry.secs = 5
# TODO: inherit_network, allow_ip_name_lookup in wasmtime_wasi::WasiCtxBuilder

[[workflow]]
name = "http_get_workflow"
location.oci = "docker.io/getobelisk/example_workflow_http_get:2024-08-12-1@sha256:d591785af59e5b0809b87a6e32bae7f590f0ea459a53d4bbcb8dc3e4322ddce3"
exec.lock_expiry.secs = 10
child_retry_exp_backoff.secs = 1

# [[http_server]]
# name = "external"
# listening_addr = "0.0.0.0:9090"

# [[webhook_trigger]]
# name = "hello_world"
# http_server = "external"
# location.path = "target/wasm32-wasip1/release/trigger_http_hello.wasm"
# path = "/"

## Send spans via gRPC to an OTLP collector.
## Defaults:
# [otlp]
# level = "info"
# service_name = "obelisk-server"
# otlp_endpoint = "http://localhost:4317"

# Stdout configuration, by default logs INFO and above.
# Comment the table to disable stdout logging.
[log.stdout]
## Defaults:
# level = "info"
# style = "plain_compact"
# span = "none"
# target = false

## Sample (rolling) file configuration
# [log.file]
# level = "info,obelisk=debug"
# style = "json"
# span = "close"
# target = true
# rotation = "daily"
# directory = "."
# prefix = "obelisk_server_daily"
